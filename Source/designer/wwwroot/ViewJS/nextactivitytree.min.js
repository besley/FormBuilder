var nextActivityTree=function(){function n(){}function i(){return{check:{enable:!0},view:{dblClickExpand:!1,showLine:!0,selectedMulti:!1},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId",rootPId:""}},callback:{beforeClick:function(n,t){var i=$.fn.zTree.getZTreeObj("nextStepTree");return t.isParent?(i.expandNode(t),!1):!0}}}}function t(){var t={},n=null,i="",r=$("#dynamicFormContainer").find("[class*=ctrl]");return r.each(function(r,u){var f=$.trim(u.className.match("ctrl-.*")[0].split(" ")[0].split("-")[1]),e=$(u).parent().find(".hiddenAttributeEntity")[0];n=$.parseJSON(e.value);n.ConditionKey&&$.trim(n.ConditionKey)!=""&&(i=dfieldManagerGet.getControlValue(f,$(u)),t[n.ConditionKey]=i)}),t}return n.mzTree=null,n.getNextActivityTree=function(){var r=lsm.getUserIdentity(),u;if(r==undefined||r==null||r.UserID=="")return $.msgBox({title:"DynFlow / GoNext",content:"请确认是否当前已经登录！",type:"alert"}),!1;u={UserID:r.UserID,UserName:r.UserName,AppName:dfmain.mcurrentAppName,AppInstanceID:dfmain.mcurrentEntityInfoID,ProcessGUID:dfmain.mcurrentProcessGUID};u.Conditions=t();jshelper.ajaxPost("api/wf/GetNextStepRoleUserTree",JSON.stringify(u),function(t){var r,f,u,e,o;t.Status===1?(r=t.Entity[0],f=[{id:0,pId:-1,name:"下一步流转",type:"root",open:!0},{id:1,pId:0,name:r.ActivityName,activityGUID:r.ActivityGUID,activityName:r.ActivityName,type:"activity",open:!1}],r.Users!=null&&(u=2,e=null,$.each(r.Users,function(n,t){e={id:u,pId:1,name:t.UserName,uid:t.UserID,type:"user"};f.push(e);u=u+1})),o=$("#nextStepTree"),n.mzTree=$.fn.zTree.init(o,i(),f)):$.msgBox({title:"DynFlow / GoNext",content:t.Message,type:"info"})})},n.sure=function(){var r=n.mzTree.getCheckedNodes(),u,i;if(r.length<=0)return $.msgBox({title:"DynFlow / GoNext",content:"请单击选中下一步人员列表再进行流转！",type:"alert"}),!1;u={};u.Users=[];var f="",e="",o=null,s=[];$.each(r,function(n,t){t.type=="activity"?(f=t.activityGUID,e=t.activityName):t.type=="user"&&(o={UserID:t.uid,UserName:t.name},s.push(o))});i={};i=dfmain.WfAppRunner;i.ProcessGUID=dfmain.mcurrentProcessGUID;i.AppName=dfmain.mcurrentAppName;i.AppInstanceID=dfmain.mcurrentEntityInfoID;i.NextActivityPerformers={};i.NextActivityPerformers[f]=s;i.Conditions=t();$.msgBox({title:"Are You Sure",content:"表单数据保存是否保存？确认下一步流转步骤："+e,type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(n){n=="Yes"&&jshelper.ajaxPost("api/wf/RunProcess",JSON.stringify(i),function(n){n.Status==1?($.msgBox({title:"DynFlow / GoNext",content:"流程已经流转到下一步！",type:"info"}),$("#modelNextStepForm").modal("hide")):$.msgBox({title:"DynFlow / GoNext",content:n.Message,type:"info"})})}})},n}();
//# sourceMappingURL=nextactivitytree.min.js.map
